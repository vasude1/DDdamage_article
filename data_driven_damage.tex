%\documentclass[12pt,twoside,letterpaper]{article}
\documentclass[11pt]{elsarticle}
\usepackage{geometry} % Load the geometry package

% Set the margins
\geometry{
	left=1.4cm,   % Left margin
	right=1.4cm,  % Right margin
	top=1.4cm,    % Top margin
	bottom=1.4cm, % Bottom margin
	footskip=1cm  % Space between the bottom of the text and the footer
}
%NOTE: This report format is 

%\usepackage{manuscript}
\renewcommand{\baselinestretch}{0.9} 
%\usepackage[authoryear]{natbib}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{lipsum}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{siunitx}
\usepackage{caption}
\usepackage{subcaption} % For subfigures
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
\usepackage{tikz} % TikZ package for drawing
\usetikzlibrary{external} % Enable externalization
\usepgfplotslibrary{external} 
\tikzexternalize[prefix=tikzfigs_pdf/] % Folder where the figures will be stored
\tikzexternalize % Activate externalization
\usepackage[super]{nth}
\newtheorem*{remark}{Remark}

\newcommand{\reporttitle}{Project: Report title}
\newcommand{\reportauthorOne}{Student 1}
\newcommand{\cidOne}{your id number}
\newcommand{\reportauthorTwo}{Student 2}
\newcommand{\cidTwo}{your id number}
\newcommand{\reporttype}{Coursework}
\bibliographystyle{plainnat}

%\usepackage[backend=bibtex]{biblatex}

\newcommand{\ext}{\mathrm{ext}}

% include files that load packages and define macros
\input{conco.tex} % various packages needed for maths etc.
%\usepackage[a4paper, total={7.5in, 8in}]{geometry}

\journal{CMAME}

\begin{document}
	
\begin{frontmatter}
	
	%% Title, authors and addresses
	
	%% use the tnoteref command within \title for footnotes;
	%% use the tnotetext command for theassociated footnote;
	%% use the fnref command within \author or \address for footnotes;
	%% use the fntext command for theassociated footnote;
	%% use the corref command within \author for corresponding author footnotes;
	%% use the cortext command for theassociated footnote;
	%% use the ead command for the email address,
	%% and the form \ead[url] for the home page:
	%% \title{Title\tnoteref{label1}}
	%% \tnotetext[label1]{}
	%% \author{Name\corref{cor1}\fnref{label2}}
	%% \ead{email address}
	%% \ead[url]{home page}
	%% \fntext[label2]{}
	%% \cortext[cor1]{}
	%% \affiliation{organization={},
		%%             addressline={},
		%%             city={},
		%%             postcode={},
		%%             state={},
		%%             country={}}
	%% \fntext[label3]{}
	
	\title{Exact Data Driven Computational Damage Mechanics - Introduction of a length scale through the relaxed Lipschitz constraint}
	
	%% use optional labels to link authors explicitly to addresses:
	%% \author[label1,label2]{}
	%% \affiliation[label1]{organization={},
		%%             addressline={},
		%%             city={},
		%%             postcode={},
		%%             state={},
		%%             country={}}
	%%
	%% \affiliation[label2]{organization={},
		%%             addressline={},
		%%             city={},
		%%             postcode={},
		%%             state={},
		%%             country={}}
	
	\author[label1]{Vasudevan Kamasamudram}
	\author[label1]{Laurent Stainier}
	
	\affiliation[label1]{organization={Centrale Nantes},%Department and Organization
		addressline={1 rue de la noe}, 
		city={Nantes},
		postcode={44321}, 
		%state={},
		country={France}}
	
	\begin{abstract}
		%% Text of abstract
		
	\end{abstract}
	
	%%Graphical abstract
	\begin{graphicalabstract}
		%\includegraphics{grabs}
	\end{graphicalabstract}
	
	%%Research highlights
	\begin{highlights}
		\item Research highlight 1
		\item Research highlight 2
	\end{highlights}
	
	\begin{keyword}
		%% keywords here, in the form: keyword \sep keyword
		
		%% PACS codes here, in the form: \PACS code \sep code
		
		%% MSC codes here, in the form: \MSC code \sep code
		%% or \MSC[2008] code \sep code (2000 is the default)
		
	\end{keyword}
	
\end{frontmatter}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\begin{document}

%The distance function is defined as
%\begin{equation}
%	d = \frac{C}{2}(\epsilon - \epsilon^*)^2 + \frac{1}{2C}(\sigma - \sigma^*)^2 + \frac{D}{2}(\epsilon_{,x} - \gamma^*)^2 + \frac{1}{2D}( \tau - \tau^* )^2 .
%\end{equation}
%$C$ and $D$ denote the quantities used to normalize the corresponding stress and strain quantities. 
%\begin{equation}
%	\Pi = \int d(\sigma,\epsilon,\sigma^*,\epsilon^*,\tau,\tau^*,\gamma^*) \diff x + \int \eta \left( \sigma - \tau_{,x}  \right)_{,x} \diff x,
%\end{equation}
	
	
\section{Introduction}

The paradigm of Data Driven Computational Mechanics has been introduced in \cite{KO}, where the constitutive model that describes the material behavior has been replaced by a database of stress-strain pairs obtained, for instance, from experimental measurements or multi-scale simulations. The technique has been applied to the problems of plasticity, viscoelasticity, non-standard continuum in various references. In this article, the methodology will be extended to the case where the material undergoes softening as a consequence of damage. 

The main challenge for such an extension is the introduction of length scale. The local models of damage result in spurious localization of strain and damage in a region that depends on the mesh size. This is a consequence of the lack of a length scale in such models. Different techniques exist in the literature to prevent this mesh dependence and regularize the problem. One of these techniques rely on the gradient of the strain to introduce the length scale onto the problem~\cite{Peerlings1999}. In this case, the equivalent strain that is used to evaluate the damage variable is computed using the strain as well as its gradient. This results in the implicit and explicit gradient models. Another approach relies on the computation of a non-local equivalent strain as a weighted integral of the strain variable~\cite{Peerlings2001,Peerlings2002}. In~\cite{Pijaudier-Cabot1987}, a non-local driving force has been defined to compute the evolution of the damage variable. On the other hand, the gradient of strain can be included in the stain energy functional directly. The result is the class of strain gradient (\emph{SG}) models, presented in~\cite{Mindlin1968,Xia1996} and references therein. The introduction of the gradient of the strain in the strain energy functional precludes the localization of strain by introducing a length scale into the model. An analysis of the \emph{SG} models in the presence of damage can be found in~\cite{Le2018}. In that study, various cases were considered, where the damage is considered to affect just the elastic (non-gradient) modulus in some cases and both the moduli in some other cases.

The difference between the two approaches in including the \emph{SG} into the analysis is that in the approach by~\cite{Peerlings2001}, the \emph{SG} is used to compute an effective strain, which in turn affects only the computation of damage. The strain energy density function remains unchanged. This can be seen to be an instance of \emph{uncoupled regularization} with strain regularization in the context of~\cite{Lorentz2003}. The \emph{SG} models in~\cite{Mindlin1968,Xia1996, Le2018}, for instance, include the \emph{SG} in the definition of the strain energy itself. In the latter case, the inclusion of gradient effects affects the solution even during the elastic phase before the material undergoes damage. Also, an analysis performed in~\cite{Le2018} reveals that the \emph{SG} models, even though they prevent the localization of damage, result in dissipation that depends on the geometry of the analyzed specimen. In short, for infinitely long specimens, using a \emph{SG} model results in an infinite dissipation.

Other methods of regularizing the problem include introducing the gradient of the damage variable in the strain energy functional, which introduces a characteristic length into the problem~\cite{Pham2011, Marigo2016}. This approach can also be compared to the \emph{Phase Field models}, see for instance~\cite{Miehe2014,Miehe2015}. The Thick Level Set method introduced in~\cite{Moes2011} makes the damage a function of the level set, the zero of which is identified to be the damage front. The norm of the gradient of the level set function is restricted to be equal to 1, which introduces the length scale into the problem.~A different approach to introducing non-locality into the model has been introduced in~\cite{Valoroso2022,Moes2021}. In~\cite{Valoroso2022}, the gradient of the damage variable has been constrained to be smaller than (a possibly damage-dependent) value. This prevents the damage from localizing in one element when using a local damage model. In~\cite{Moes2021}, the damage variable is instead constrained to be Lipschitz continuous. This introduces a length scale into the model and prevents the mesh dependence of the solution as in the previous case.

The standard Finite Element techniques obtain the solution of the equations of equilibrium and in this process, a constitutive model is used to describe the behavior of the material. In~\cite{Kirchdoerfer2016}, the material behavior is instead taken to be described by the stress-strain data, ideally obtained from the experiments, thereby eliminating the need for a constitutive model. The methodology is described as \emph{Data Driven Computational Mechanics, DDCM}. The problem is described as obtaining the \emph{mechanical state} - pair of strains and stress, $(\epsilon,\sigma)$, that satisfies the equations of equilibrium and the strain-displacement relations. A \emph{distance} is defined between the mechanical state and the \emph{material states} - the strain-stress data that describes the behavior of the material. In addition to satisfying the equilibrium and compatibility equations, the mechanical states also minimize the distance functional to the set of the material states. An extension of the DDCM to inelastic cases has been performed in~\cite{Eggersmann2019,Karapiperis2021,Karapiperis2021a}. In~\cite{Karapiperis2021, Karapiperis2021a}, the DDCM has been used to describe the behavior of granular materials and a formulation equivalent to the Cosserat media has been used in~\cite{Karapiperis2021a} to prevent the spurious (shear) strain localization in the numerical simulations.


However, the use of the Cosserat model to regularize the problem requires the presence of shear effects. Hence, they may not be effective in regularizing the spurious localization encountered under mode-I loading (see~\cite[page~30]{Peerlings1999}) as the rotational degrees of freedom do not become active under such loading. Also, the \emph{internal variables} such as damage typically used in the regularization are not explicitly introduced in DDCM. Hence, the current study intends to introduce the notion of length scale into the problem by modifying the space of displacement functions from where the solution is sought. The search space is modified to include only such functions whose second gradients are between $-1/\ell_c$ and $1/\ell_c$. In other words, the gradient of strains is restricted to lie in the interval $[-1/\ell_c,1/\ell_c]$. During the minimization of the strain energy density functional, the second displacement gradients are constrained by using Lagrange multipliers. This can also be interpreted as limiting the energy associated with the gradients of strain to a certain value. This leads to some resemblance of the method presented to the \emph{SG} models.

This article presents the continuum version of the regularization technique where the behavior of the material will be described by a constitutive function. It shall be noted that the intent is to use this methodology with the DDCM, where the FE simulations are performed entirely using the database without any model. Thus, the constitutive model presented in the next section will be replaced by a database of stress-strain pairs. This can be seen as using DDCM for inelastic materials, for instance as in~\cite{Eggersmann2019}, but with the regularization presented in this article. This will be the focus of the future work. Since the regularization is applied on the strains rather than internal variables, the proposed methodology indeed remains valid even in the context of DDCM.


\section{Data driven solver}
In this section, the dara driven solver will be introduced briefly. For this purpose, the notions of mechanical and material states are introduced as below. A stress-strain state, $(\sigma,\epsilon)$, is called a mechanical state if the stress state, $\sigma$, satisfies the conditions of equilibrium and the strain state, $\epsilon$, satisfies the compatibility conditions, where the displacement fields satisfy the Dirichlet boundary conditions. At each point in the body, the material state, $(\sigma^*,\epsilon^*)$, belongs to the material manifold, $\mathcal{D}$, typically obtained from experiments or from simulations performed at lower scales. The equilibrium manifold is defined as 
\begin{equation}
	\mathcal{E} = \{ (\sigma,\epsilon) \text{ }|\text{ } \sigma,\epsilon \text{ are sufficiently smooth, } \divop \sigma = 0 \text{ and } \epsilon=\sym\nabla u, u=u_D \text{ on } \partial \Omega_d  \}.
\end{equation}
The solution is sought as the intersection of the two manifolds.
\begin{equation}
	\text{Sol} \in \mathcal{D} \cap \mathcal{E}.
\end{equation}
In case where the material behavior is defined by a discrete collection of stress-strain pairs, a strict intersection may not exist between the two manifolds. In such a case, the solution is sought as the mechanical-material states that are closest to each other with respect to a certain distance. In discrete case (such as in Finite Element Method, where each element in the mesh is associated with a pair of mechanical and material states), the distance is defined as  
\begin{equation}
	d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{1}{2}(\bfeps - \bfeps^*)^T\mathcal{C} \bfw(\bfeps - \bfeps^*) + \frac{1}{2}(\bfsig - \bfsig^*)^T\mathcal{C}^{-1}\bfw(\bfsig - \bfsig^*), \label{distance_func_orig}
\end{equation}
where $\bfw$ is vector containing the areas of elements, and $\mathcal{C}$ denotes a \textit{metric}. $\bfeps,\bfsig,\bfeps^*, \bfsig^* \in \mathbb{R}^{3N}$, $N$ denotes the number of elements, and $\bfw \in \mathbb{R}^{3N}$. $\bfw \bfsig$ thus indicates an element-wise operation. The discrete equilibrium manifold is defined as  
\begin{equation}
	\mathcal{E} = \{ (\bfsig,\bfeps) \quad | \bfB^T \bfw\bfsig = \boldsymbol{0} \text{ and } \bfeps=\bfB \bfu, \bfu=\bfu_D \text{ on } \partial \Omega_d  \}.
\end{equation}
In the above, $\bfB$ denotes the discrete strain-displacement operator. Thus, $\bfeps = \bfB \bfu$. Thus, the solution is the minimizer of the distance functional.
\begin{equation}
	\text{Sol} \in \arg \min d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) \text{ } \stoper \text{ } (\bfsig , \bfeps) \in  \mathcal{E} \text{ and } (\bfsig^* , \bfeps^*) \in  \mathcal{D}.
\end{equation}
The minimization can be carried out by imposing the constraints using Lagrange multipliers. The minimization process is divided into mechanical and material updates. During the mechanical update, the material states, denoted by the asterisked quantities are held fixed. The minimization is carried out wrt the mechanical states. During the material update, the mechanical states are held fixed and the minimization is carried out wrt material states.
The corresponding Euler Lagrange equations during the mechanical update can be seen to be:

\begin{gather}
	\bfB^T \mathcal{C}\bfw \bfB \bfu = \bfB^T \mathcal{C}\bfw \bfeps^*, \\
	\bfsig - \bfsig^* =  \mathcal{C} \bfB \bfeta, \\
	\bfB^T \bfw\bfsig = \mathbf{0}.
\end{gather}

\section{1D case check : Garbage in - Garbage out}
To begin with, it is necessary to determine whether the DD algorithm results in an expected mesh dependence, as is the case with a model when there is no regularization introduced into the problem. The database in this scenario consists of a collection of stress-strain pairs that includes softening. It is well known that the accuracy of the solution obtained with the DD method depends on the resolution of the phase space by the data. Since, in the present case, the strain increments in the body is expected to be non-homogeneous due to localization effects, the resolution of the phase space might be even more critical. Thus, to mitigate the issues arising from insufficient data and phase space resolution, it will be assumed that the database can be approximated by a series of piecewise affine relations. For instance, $\sigma=E \epsilon$ describes the \textit{elastic part}, $\sigma = m\epsilon + c$, the \textit{softening part}, $\sigma = E_i \epsilon$, the $i$th unloading branch. See figure \ref{database_actual}. This corresponds to the case where the database size tends to infinity. In such a case, the material update can be performed analytically, as demonstrated in \ref{appx_convergence}. It is also important to determine if applying the DD method to softening scenario will affect the (rate of) convergence of the method. Therefore, a simplified problem will be analyzed first.

\begin{figure}
	\centering
	\includegraphics[width=0.5\linewidth]{Images/1D_bar_bf.pdf}
	\caption{1D bar with a body force \label{1D_bar_bf}}
\end{figure}



\subsection{Convergence of the method and its rate}

Since the problem to be analyzed implicitly contains non-convexity (though the structure of the database), it is expedient to first examine the effect of various parameters (the metric in particular) on the convergence of the method. Thus, a simplified problem will first be studied. The problem setup together with the minimization procedure can be found in \ref{appx_convergence}. 

As shown in the appendix, the rate of convergence of the method (and whether it converges at all) can be determined by analyzing the matrix $\bfC \bfA $. It has been assumed that there is no body force and that all but one elements are on the elastic (unloading) branch and only one element moves on the damage branch. This setup corresponds to picking one of several possible bifurcation states from the homogeneous state. Two cases can thus be considered (depending on the mesh size): one with a snapback and one without. 

\subsubsection*{No snapback}
No snapback occurs when the mesh size and hence, the localization length, is big enough. Thus, a direct displacement control has been used. In such a case, the assumptions made above (regarding the elements belonging to the loading and unloading branches) are valid and the analysis in the appendix can be used to judge the rate of convergence. The analysis has been performed by setting $N=10, E=100, m=-0.0667, c=100.0667$. When $C_1=C_2=E$, the spectral radius of the matrix $\bfC \bfA $ in equation \ref{combined_equn} has been found to be $0.993$. However, when $C_2=m$, the spectral radius decreased to $0.5$. This indicates that the number of iterations needed for convergence, which is considered to have occurred when the distance functional is sufficiently small, depends on the value of the parameter $C_2$.

The successive mechanical and material states for the elements on the elastic and damage branch, stating from the \textit{yield point}, can be seen in figures \ref{bad_metric_no_snap} and \ref{good_metric_no_snap} for the two cases $C_2=E$ and $C_2=m$, respectively. Since the spectral radius for the case $C_2=E$ is very close to $1$, the successive iterates can be seen very close to each other. Consequently, the mechanical and material states remain far apart. In contrast, when $C_2=m$, the mechanical and material states approach each other much faster, and the solution converges within just 7 iterations. For $C_2=E$, since the successive material states are very close to each other, convergence will be judged to have occurred if the criterion for convergence based on the change of successive material states is used (and this is the criterion used traditionally). It shall also be noted that in the case $C_2=E$, the (mechanical) strain changes for the elements on the elastic and the damage branch point in the same direction (positive) as the external load (also positive). But when $C_2=m$, the sign of the strain change for the element on the damage branch is same as the external load, while for the element on the elastic branch, it is the opposite. Thus, when $C_2=E$, the system favors the homogeneous branch of the solution.

This case has also been tested using an arc length constraint instead of driving the system with an applied displacement. The details of the arc length constraint can be seen in the appendix. The parameters used are same as earlier. The strain increment in the arc length is taken so that the resulting solution is same as in the case of the applied displacement. In this case, the successive mechanical and material states can be seen in figures \ref{bad_metric_no_snap_arc_length} and \ref{good_metric_no_snap_arc_length}. As earlier, the successive states are very close to each other when $C_2=E$. However, when $C_2=m$, the rate of convergence is optimal - the successive states can be seen exactly same as in the earlier case. Also, the same observation can be made regarding the signs of the initial strain changes.

\subsubsection*{With snapback}

When $N$ is changed to $100$, that is when the mesh is refined, a snap back is expected to occur. In this case, as will be demonstrated, an arc length method is required to track the evolution of the solution. The case where an arc length solver is not used when a snap back occurs will be discussed later. 

The progression of the mechanical and the material states in this case can be seen in figures \ref{bad_metric_snap_no_arclength} and \ref{good_metric_snap_no_arclength}. In this case, it is necessary to take $C_2=m$ to arrive at a converged solution. As can be seen in figure \ref{bad_metric_snap_no_arclength}, if $C_2=E$, the mechanical strain change for both the elements point in the same direction. In subsequent iterations, the same material state is selected for the element on the elastic branch (as it has restricted to remain on the elastic branch in the current case to study the bifurcated solution). As a result, the distance functional stagnates at a high value and does not change anymore regardless of the number of iterations. However, when $C_2=m$, not only is the rate of convergence optimal, but also the algorithm converges, and to the correct solution.

To investigate whether an arc length solver is absolutely needed - that is, to study the capability of the data driven algorithm to \textit{jump through} snap backs - the case with a snapback has been studied without using an arc length solver. The system is thus displacement driven. The successive iterates in this case can be seen in figures \ref{bad_metric_snap_no_arclength} and \ref{good_metric_snap_no_arclength}. When $C_2=E$, the successive mechanical and material states can be seen to move further away from each other. The distance functional in this case thus increases as the iterations progress. When $C_2=m$, the mechanical and the material states change during the first iteration, but no more during the further iterations. It shall also be noted that the strain in the elements on the damage branch decreases, while the strain in the elements on the elastic branch increases. This is consistent with the fact that the smallest eigen value of the system becomes negative when $C_2=m$ and a snapback occurs. Thus, the sign of the strain change for the element on the damage branch is opposite to the sign of the external load change. Hence, when the applied displacement increases, the strain in the damage branch tends to decrease, while the strain in the elastic branch tends to increase. See chapter 3 of \cite{deBorst1986}, \cite{deBorst1987b}, and \cite{Baldelli2021} for discussion on continuation methods for cases when the Hessian matrix loses its positive definiteness. This is however beyond the scope of this article and the arc length solver will be used hereafter instead.

To ensure that the above observations hold regardless of the initial state of the mechanical and material states, the analysis above is repeated with a different initial point, where the elements on the elastic and the damage branch are further away from the \textit{yield point}. The progression of the iterates through the iterations can be seen in figures \ref{bad_metric_snap_no_arclength_add} and \ref{good_metric_snap_no_arclength_add}. As earlier, when the applied displacement increases, the mechanical and material states move as the same direction as the applied displacement after the first iteration. The subsequent iterations take the mechanical state for the element on the damage branch further from its material state, and the solution stagnates at a point which is very far from the expected solution (a fully damaged state for the current element on the damage branch). The situation is similar when $C_2=m$, but with a fewer number of iterations.

\begin{figure}[]
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/bad_metric_no_snap.pdf}
		\caption{$C_2=E$, no snapback, and without the arc length constraint.}
		\label{bad_metric_no_snap}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/good_metric_no_snap.pdf}
		\caption{$C_2=m$, no snapback, and without the arc length constraint.}
		\label{good_metric_no_snap}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/bad_metric_no_snap_arc_length.pdf}
		\caption{$C_2=E$, no snapback, and with the arc length constraint.}
		\label{bad_metric_no_snap_arc_length}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/good_metric_no_snap_arc_length.pdf}
		\caption{$C_2=m$, no snapback, and with the arc length constraint.}
		\label{good_metric_no_snap_arc_length}
	\end{subfigure}
\end{figure}
\begin{figure}\ContinuedFloat
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/bad_metric_snap_arc_length.pdf}
		\caption{$C_2=E$, snapback, and with the arc length constraint.}
		\label{bad_metric_snap_arc_length}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/good_metric_snap_arc_length.pdf}
		\caption{$C_2=m$, snapback, and with the arc length constraint.}
		\label{good_metric_snap_arc_length}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/bad_metric_snap_no_arclength.pdf}
		\caption{$C_2=E$, snapback, and without the arc length constraint.}
		\label{bad_metric_snap_no_arclength}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/good_metric_snap_no_arclength.pdf}
		\caption{$C_2=m$, snapback, and without the arc length constraint.}
		\label{good_metric_snap_no_arclength}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/bad_metric_snap_no_arclength_add.pdf}
		\caption{$C_2=E$, snapback, different initiation, and without the arc length constraint.}
		\label{bad_metric_snap_no_arclength_add}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.7]{./conv_figs/good_metric_snap_no_arclength_add.pdf}
		\caption{$C_2=m$, snapback, different initiation, and without the arc length constraint.}
		\label{good_metric_snap_no_arclength_add}
	\end{subfigure}
\centering
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[scale=0.9]{./conv_figs/legend.pdf}
	\end{subfigure}
	\caption{Results from the analysis of various cases in 1D are presented. The successive iterates for the material states are denoted by circles, while the mechanical states are represented by asterisks. The successive iterates are connected by arrows: dashed arrows for the elements on the elastic unloading branch and dash-dotted arrows for the elements on the damage branch.}
	%\label{fig:ut_regularization}
\end{figure}

\begin{remark}
Thus, it can be concluded that not only is using an optimal value for $C_2$, together with an arc length solver, sufficient to achieve an optimal rate of convergence, but it is also necessary to achieve convergence in some cases.
\end{remark}

\subsection{A 1D bar with a body force}
The problem of 1D bar subjected to a body force as in figure \ref{1D_bar_bf} will now be analyzed. The same problem will then be used to demonstrate the effect of introducing a length scale into the problem. The set of equations that govern the data driven solution can be found in the previous section. An arc-length solver will be used to capture the (possible) snapback response of the bar. The bar is meshed with piecewise linear and continuous displacement elements. The mechanical stresses are taken to be piecewise constant. The mesh size is homogeneous. The problem is examined for two mesh sizes (say $\ell_e$, $0.5 \ell_e$) to determine the effect of the mesh size on the response of the bar.

\begin{figure}
	\centering
	\includegraphics[width=0.4\linewidth]{Images/database_actual.pdf}
	\caption{Stress strain database \label{database_actual}}
\end{figure}



The force at the right end of the bar vs the applied displacement until complete failure (where some element in the bar is fully damaged) for the two mesh sizes can be seen in Figure \ref{force_disp_local}. The mesh dependence of the strain distribution, together with the snapback response, can be clearly seen once the \textit{damage begins to increase}. At the first step, a compressive force is developed as a consequence of the body force, which gradually becomes positive as the displacement is increased. The initial negative displacement is a consequence of the arc-length constraint that the strain increment in the left most element is equal to a certain (user specified) value. As the load is increased further, the damage initiates at the left end (just at the left end because of the applied body force). The strain and the damage localize in the element at the left end in the subsequent steps until the element undergoes a complete failure ($d=1$). A small compressive load can again be seen at the end as a consequence of the applied body force. The corresponding strain distributions, at complete failure, for the two mesh sizes can be seen in figure \ref{strain_dist_local}. The mesh dependence of the solution is obvious.

\begin{figure}[ht]
	\begin{subfigure}{0.45\textwidth}
		\centering
		\input{./tikz_figs/force_disp_local.tex}
		\caption{Force vs Displacement curves for two mesh sizes.}
		\label{force_disp_local}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\input{./tikz_figs/strain_dist_local.tex}
		\caption{Strain distribution along the bar.}
		\label{strain_dist_local}
	\end{subfigure}
	\caption{Results without regularization}
	\label{fig:Results_without_regularization}
\end{figure}



Thus, with the ingredients presented (the arc length solver and the choice of metric), the data driven solver is able to exhibit the mesh dependence of the solution as expected when there is no regularization.

\begin{remark}
	Results from the analysis performed in \ref{appx_convergence} reveals that an optimal rate of convergence is obtained when the metric in the distance functional is taken equal to the tangent, $\parder{\sigma^*}{\epsilon^*}$, obtained from the corresponding material state. For materials that undergo damage, this derivative is negative. Thus, during the alternate minimization process, for the elements that undergo damage, $C$ is smaller than zero. It shall be noted that the convergence of the solver is still judged on the basis of the metric that is equal to the elastic modulus and the tangent is used only during the alternate minimization and the corresponding Newton iterations. It shall be noted that in some cases, not using the tangent as a metric resulted in the solution converging to an \textit{incorrect} solution.
\end{remark}

\begin{remark}
	In non DD setting, the damage problem involves minimizing a functional that is non-convex. The energy density is a function of displacement and damage, and is separately convex with respect to the two variables. Thus, the minimization is performed alternatively between the two variables to find the solution. The problem is thus \textit{convexified} in non-DD setting. This allows the minimizers to \textit{jump through} instabilities such as snapbacks under displacement control (the number of iterations needed might be higher, though). It shall be noted that using a Newton solver (without additional refinements) for non-convex minimization may lead to unconvergence \cite{Farrell2017,Gerasimov2016}.
	
	In DD setting, however, the database looks like in figure \ref{1D_bar_dam_elem} and thus, the nonconvexity is inherently contained in the database. Thus, an arclength method has been used to track the entire bifurcation branch without having to jump through. Also, it is unclear is it is indeed possible to jump through snapbacks in this case as the convexity is not specifically handled. 
\end{remark}

\section{Introduction of a length scale}

In the previous section, it was demonstrated that the Data Driven algorithm with no regularization (and a \textit{local} database) results in mesh dependence of the solution (as expected). Here, the strain based Lipschitz regularization, introduced in \cite{Kamasamudram2023}, will first be developed for the Data driven case (for 1D). It will then be applied for the problem introduced in the previous section. A relaxed version of the method will then be developed and presented for the 2D case later on.

\subsection{The method}
The regularization technique was introduced in \cite{Kamasamudram2023}, where it was tested with a constitutive model. Here, it will first be extended for use with the DDCM methodology.

To begin with, a length scale is introduced into the problem by restricting the gradient of the strain variable to lie in a certain interval. More precisely, it is required that $\epsilon_{,x} \in [-1/{\ell_c}, 1/{\ell_c} ]$, where $\ell_c$ is a length parameter. It is expected that the introduction of this constraint prevents the spurious strain localization, and the dependence of the solution on the Finite Element mesh size. 


The introduction of the Lipschitz constraint on the strain variable modifies the equation of equilibrium (in 1D) to 
\begin{equation}
	\sigma_{,x}- \lambda_{,xx}=0,\label{equil_couple_1D}
\end{equation}
see equation 37 of \cite{Kamasamudram2023}, where $\lambda$ is the Lagrange multiplier that is dual to the Lipschitz constraint. Also, $\lambda \neq 0$ only in the regions of the body where the constraint is active. The equations of equilibrium used in DDCM should thus take this into account. 

Beginning with the distance functional,
\begin{equation}
	d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{1}{2}(\bfB \bfu - \bfeps^*)^T\mathcal{C}\bfw(\bfB \bfu - \bfeps^*) + \frac{1}{2}(\bfsig - \bfsig^*)^T\mathcal{C}^{-1}\bfw(\bfsig - \bfsig^*),
\end{equation}
the objective now is to find the minimizers of the above functional so that the strain field satisfies the Lipschitz constraint, and the stress fields satisfy the equilibrium. As already mentioned, the Lagrange multipliers that enforce the constraint on the strain field act as couple stresses.
\begin{equation}
	\text{Sol } \in \arg \min_{(\bfeps,\bfsig) \in \mathcal{E}, (\bfeps^*,\bfsig^*) \in \mathcal{D}} d(\bfeps,\bfsig,\bfeps^*,\bfsig^*),
\end{equation}
where, the equilibrium manifold is now defined as (in discrete form)
 

\begin{equation}
	\mathcal{E} = \{(\bfeps,\bfsig) : \bfeps = \bfB \bfu, \bfeps \text{ is such that } |\bfB' \bfeps|  \leq 1/{\ell_c} ,\bfu = \bfu_D \text{ on } \partial \Omega_d,
	\text{ and } \bfB ^T\bfw \bfsig + \bfP^T \bflam = 0     \},
\end{equation}
where $\bflam$ is the Lagrange multiplier. $\bfB'$ is the discrete gradient operator on the strain variable (see figure \ref{mesh_dual_1d}), and $\bfP = \bfB \bfB'$ is the discrete second gradient operator. To facilitate things, the Lagrangian will be redefined as follows:
\begin{equation}
	\Pi = d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) - \bfeta^T \bfB ^T \bfw\bfsig + \sum_{i=1}^{N_c} \lambda^u_i \left( (\bfP \bfu)_i - \frac{1}{\ell_c}   \right) + \sum_{i=1}^{N_c} \lambda^{\eta u}_i \left( (\bfP (\bfu + \bfeta))_i - \frac{1}{\ell_c}   \right).
\end{equation}
Here, $N_c$ denotes the number of active constraints and $\lambda^u_i \geq 0$ are the Lagrange multipliers dual to the constraint on the gradient of strain, and $(\bullet)_i$ denotes the $i$th component of the vector $\bullet$. The solution is defined as the collection that renders the Lagrangian stationary.
\begin{equation}
	\Pi  \leftarrow \statop!
\end{equation}

\begin{remark}
	The third and the fourth terms in the Lagrangian warrant some discussion. It is clear that the third term, together with the condition that $\lambda^u\geq0$, enforces the inequality constraint $\epsilon_{,x} \leq 1/\ell_c$. Treating $\bfeta$ as the virtual displacement, the fourth term enforces the constraint that in the regions where the inequality constraint is satisfied as an equality, the perturbed field, $\bfu+\bfeta$, must also satisfy the constraint as an equality. It shall be noted that there is a priori no restriction on the sign of $\lambda_{\eta u}$. However, as will be demonstrated below, at convergence, $\lambda^{\eta u}_i = -\lambda^{ u}_i$. This, owing to the restriction on $\lambda_u$, determines the sign of $\lambda_{\eta u}$.
\end{remark}

 


The Euler Lagrange equations can be seen to be
\begin{gather}
	\bfr_{\bfu} = \bfB^T \mathcal{C}\bfw \bfB \bfu - \bfB^T \mathcal{C}\bfw \bfeps ^* + \bfP^T \bflam^u +\bfP^T \bflam^{\eta u}  =0, \label{residual_u_1D_DD} \\
	\bfr_{\bfeta} = -\bfB^T\bfw \mathcal{C} \bfB \bfeta - \bfB^T\bfw \bfsig ^* +\bfP^T \bflam^{\eta u} =0, \\
	r_{\lambda^u_i} =  (\bfP \bfu)_i - \frac{1}{\ell_c}  =0, \\
	r_{\lambda^{\eta u}_i} =  (\bfP (\bfu + \bfeta))_i - \frac{1}{\ell_c}  =0. 
\end{gather}

At convergence, $\bfeps=\bfeps^*$ and $\bfeta=0$. Thus, from equation \ref{residual_u_1D_DD}, it can be seen that $\lambda^u_i = -\lambda^{\eta u}_i$, as mentioned earlier. The equations of equilibrium can be recovered as $\bfB^T \bfw \bfsig +\bfP^T \bflam^{u} =0$, since $\bfsig = \bfsig^*$ at convergence.

\subsection{Application and results}
The regularization technique is now applied to the DDCM case tested earlier with a body force. The value of $\ell_c$ is taken to be $0.1\si{\meter}$. Arc length solver has been used like in the previous case with similar loading conditions. A piecewise linear and continuous interpolation has been used for displacement and a piecewise constant for the mechanical stress. A dual mesh had been used to impose the constraint on the strain gradient. The strain is taken to be piecewise linear and continuous on the dual mesh. See figure \ref{mesh_dual_1d}. In this case, the discrete gradient operator $\bfB'$ is calculated on the dual (red) mesh.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.5\linewidth]{./mesh_dual_1d.pdf}
	\caption{Mesh for displacement and strain}
	\label{mesh_dual_1d}
\end{figure}



\begin{figure}[ht]
	\begin{subfigure}{0.45\textwidth}
		\centering
		\input{./tikz_figs/force_disp_nonlocal.tex}
		\caption{Force vs Displacement curves for two mesh sizes.}
		\label{force_disp_nonlocal}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.45\textwidth}
		\centering
		\input{./tikz_figs/strain_dist_nonlocal.tex}
		\caption{Strain distribution along the bar.}
		\label{strain_dist_nonlocal}
	\end{subfigure}
	\caption{Results with regularization}
	\label{fig:Results_with_regularization}
\end{figure}

The load displacement curves and the strain distribution at failure can be seen in figures \ref{force_disp_nonlocal} and \ref{strain_dist_nonlocal} for two different mesh sizes. A couple of observations warrant a closer look. First, as discussed in \cite{Kamasamudram2023}, the constraint shall be removed from the elements that are fully damaged to allow for the strains to localize in the fully damaged element and prevent the expansion of damage further into the body. The black dot in figure \ref{force_disp_nonlocal} corresponds to the case when the constraint is deactivated - the force displacement curve suddenly jumps to zero force. This situation is trivial in 1D, but is susceptible to cause convergence issues in 2D case. See \cite{Geers1998,Cabot2014,Le2018} and the references therein for similar discussions where the damaged regions extend across the body. Second, taking a closer look at the force-displacement curve as in figure \ref{force_disp_nonlocal_zoom}, a number of smaller snapbacks can be observed. It can be explained as follows: since the regularization is introduced through an inequality constraint, and this constraint is numerically resolved with a finite mesh size, the regularization is inactive until strain localizes in the some region of the body. The strains then grow locally till the constraint becomes active. Once activated, the constraint expands the damage zone further into the neighboring elements, where the strains again grow locally. This process carries on until some part of the body is fully damaged. Thus, the problem switches between a local (albeit with a varying length scale) and non-local problem as the constraint is activated and the damage spreads into other elements. The snapback occurs when the strains localize and the recovery corresponds to the activation of the constraint. It can also be seen that the amplitude of this sawtooth like pattern decreases as the mesh is refined, but the number of tooth increases.


\begin{remark}
	In hindsight, deactivating the constraint only after an element is fully damaged does indeed cause convergence issues in 2D. This issue has been discussed in multiple references - in the context of non-local damage models in \cite{Geers1998}. Thus, for the 2D case, the constraint is gradually weakened as the damage value increases. Also, to reduce the impact of sawtooth like pattern, the inequality constraint is weakened and a log-barrier-like function is used instead. More details can be found in the sections below.
\end{remark}


\begin{figure}[ht]
	\centering
	\input{./tikz_figs/force_disp_nonlocal_zoom.tex}
	\caption{Force vs Displacement curves for two mesh sizes zoomed in.}
	\label{force_disp_nonlocal_zoom}
\end{figure}

Thus, in the 1D case, the proposed regularization technique ensures that the result remains independent of the mesh size, as expected. To address the challenges associated with the abrupt deactivation of the constraint once an element is fully damaged, an alternative approach is presented below for the 2D case, in which the regularization is gradually weakened as the damage increases.

\section{2D Case}

% This, combined with the arc-length method, would render the method tedious and expensive?? 
As mentioned in the previous section, the strain based Lipschitz constraint introduces a length scale into the problem and results in a mesh independent solution. However, as was seen, the inequality constraint introduces a saw-tooth like pattern in the force-displacement response, which can be tedious to track. Also, to ensure that the damage zone does not extend across the body, the constraint (ane thus, the length scale) will have to be removed from the fully damaged regions of the body. Thus, two modifications will be introduced in this section in its extension to 2D. First, the constraint will be gradually weakened as the damage level increases. Second, the inequality constraint will be replaced by a log-barrier-like function. The EL equations corresponding to the Lagrangian can be seen later on. 

The body is assumed to be triangulated by constant strain triangles, referred to as the primary mesh. Consequently, the displacement is piecewise linear and continuous across the elements, while the stress field is taken to be piecewise constant in each element. Thus, each element is associated with a single mechanical and material state. To impose the constraints on the gradient of strain, a dual mesh is introduced. The dual mesh consists of another set of constant strain triangles defined using the centroids of the triangles of the primary mesh as vertices. The strain field is then interpolated over the dual mesh in a piecewise linear manner. The gradient of strain, is thus piecewise constant over the triangles of the dual mesh.

The distance functional remains as
\begin{equation}
	d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{1}{2}(\bfB \bfu - \bfeps^*)^T\mathcal{C}\bfw(\bfB \bfu - \bfeps^*) + \frac{1}{2}(\bfsig - \bfsig^*)^T\mathcal{C}^{-1}\bfw(\bfsig - \bfsig^*).
\end{equation}
The solution is then defined as the one that renders the following functional stationary.
\begin{equation}
	\Pi  = d -\bfeta ^T \bfB^T \bfw \bfsig - \mu \sum_{i=1}^{N_c} \
	w_i' \ln s_u{_i} + \mu \sum_{i=1}^{N_c} \
	w_i' \ln s_\eta{_i} +\sum_{i=1}^{N_c} \lambda_u^ i \left\{ s_u{_i}  - \left[ \frac{1}{\ell_c}- \psi_i(\bfu) \right]  \right\} 
	+\sum_{i=1}^{N_c} \lambda_\eta^ i \left\{ s_\eta{_i}  - \left[ \frac{1}{\ell_c}- \psi_i(\bfu+\bfeta) \right]  \right\}.
\end{equation}

The factors $ w_i'$ denotes the area of the dual elements and is thus similar to $ \bfw$ in equation \ref{distance_func_orig}. $s_u{_i},s_\eta{_i}$ are the slack variables. $\lambda^i$ are the Lagrange multipliers that define the slack variables. $\psi_i$ are the energies associated with the gradient of strain as defined below. When the constraints are to be relaxed gradually, the functional becomes
\begin{multline}
	\Pi  = d -\bfeta ^T \bfB^T \bfw \bfsig - \mu \sum_{i=1}^{N_c} \
	w_i' \ln s_u{_i} + \mu \sum_{i=1}^{N_c} \
	w_i' \ln s_\eta{_i} +\sum_{i=1}^{N_c} \lambda_u^ i \left\{ s_u{_i}  - \left[ \frac{1}{\ell_c}- g(d_i)\psi_i(\bfu) \right]  \right\} \\
	+\sum_{i=1}^{N_c} \lambda_\eta^ i \left\{ s_\eta{_i}  - \left[ \frac{1}{\ell_c}-g(d_i) \psi_i(\bfu+\bfeta) \right]  \right\},
\end{multline}
where $g$ is a function such that $g(0)=1$ and $g(1)=0$. The function $\psi$ is defined, similar to in \cite{Mindlin1968}, as 
\begin{equation}
	\psi_i(\bfu ) = \bfu ^T \bfG_i ^T \bfG_i \bfu,
\end{equation}
where $\bfG_i$ denotes the discrete second gradient operator, written on the $i^{th}$ dual element.

\begin{remark}
	A couple of observations are warranted. First, the function $g$ is selected so that $g(0)=1$ and $g(1)=0$. This means that when there is no damage, the regularization is fully effective, and when fully damaged, the regularization is removed. The transition between the two states is gradual if $g$ is smooth. Second, in this study, the parameter $\mu$ is fixed to be a finite positive value. It shall be noted that the method resembles the interior point method of resolving inequality constraints in the standard optimization setting, where successive problems are solved with decreasing $\mu$, $\mu \to 0$. Thus, as the parameter $\mu$ is made smaller, the method presented here boils down to the inequality case and the problems/ features about snapback that were observd in the 1D case return. It is expected that taking $\mu$ to be finite and fixed prevents this issue. 
\end{remark}

The Euler Lagrange equations can be obtained by taking the variations of the potential energy functional.
\begin{gather}
	\bfr_{\bfu} = \bfB^T \mathcal{C} \bfw(\bfB \bfu - \bfeps^*) + \sum_{i=1}^{N_c} 2 \lambda_u^ i  g(d_i) \bfG_i ^T \bfG_i \bfu
	+\sum_{i=1}^{N_c} 2 \lambda_\eta^ i  g(d_i) \bfG_i ^T \bfG_i (\bfu+\bfeta) = \bf0, \\
	\bfr_{\bfeta} = -\bfB^T \bfw(\bfsig^*+ \mathcal{C} \bfB \bfeta ) 
	+\sum_{i=1}^{N_c} 2 \lambda_\eta^ i  g(d_i) \bfG_i ^T \bfG_i (\bfu+\bfeta) = \bf0, \\
	r_{\lambda_u^ i} = \bfu ^T \bfG_i ^T \bfG_i \bfu - \frac{1}{\ell_c} +  s_u{_i} = 0, \\
	r_{\lambda_\eta^ i} = (\bfu+\bfeta) ^T \bfG_i ^T \bfG_i (\bfu+\bfeta) - \frac{1}{\ell_c} +  s_\eta{_i} = 0, \\ 
	r_{s_u{_i}} = \lambda_u^ i s_u{_i} - \mu w_i'   = 0, \\
	r_{s_\eta{_i}} = \lambda_\eta^ i s_\eta{_i} - \mu w_i'   = 0.
\end{gather}
The tangent matrix used during the Newton iterations can be seen in the appendix.

\begin{remark}
As in the 1D case, at convergence, $\bfeps = \bfeps^*$, and $\bfsig = \bfsig^*$. Thus, $\lambda_\eta^ i = -\lambda_u^ i$. Also, the Lagrange multipliers that take the role of couple stresses are computed as $\lambda_u^ i  =  \mu w_i'/ s_u{_i} >0$ since $s_u{_i} >0$ as a consequence of the log-barrier-like regularization.
\end{remark}

\section{Applications}
\subsection{A bar with a notch}
The regularization technique described above will be applied to the case of a 2D-1D bar as shown in figure \ref{2d_1d_bar_dims}. The left side of the bar is fixed. A horizontal displacement is applied to the right end, which is controlled by an arc-length method to be described in appendix. The displacement fields are approximated by constant-strain triangles. The strain variable is then interpolated on the dual mesh which is then used to compute the strain gradient. The geometry of the bar can be seen in figure \ref{2d_1d_bar_dims}.

\begin{figure}
	\centering
	\includegraphics[width=\linewidth]{./Images/2d_1d_bar/2d_1d_bar.pdf}
	\caption{Geometry of the bar with a notch. All dimensions are in meters.}
	\label{2d_1d_bar_dims}
\end{figure}


\begin{figure}[ht]
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{./Images/2d_1d_bar/damage_coarse.pdf}
		\caption{Coarse mesh}
		\label{2d_1d_bar_damage_coarse}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{./Images/2d_1d_bar/damage_inter.pdf}
		\caption{Intermediate mesh}
		\label{2d_1d_bar_damage_inter}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[width=\linewidth]{./Images/2d_1d_bar/damage_fine.pdf}
		\caption{Fine mesh}
		\label{2d_1d_bar_damage_fine}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\vfill
		\includegraphics[width=0.4\linewidth]{./Images/2d_1d_bar/cb.pdf}
	\end{subfigure}
	\caption{Results with regularization - A notched bar}
	\label{2d_1d_bar_damage}
\end{figure}

Figure \ref{2d_1d_bar_damage} shows the damage distribution attached to the material states associated with each element. The results are for three mesh sizes, where the ratio of element sizes of the coarse mesh to the intermediate mesh, and of the intermediate mesh to the fine mesh is 2. The variation of damage value across the center of the bar, from $(0.08,0.01)$ to $(0.12,0.01)$, where the origin is at the bottom left corner of the bar, can be seen in figure \ref{1D_comparison_x}. Force-displacement curves for all the three mesh sizes can be seen in figure \ref{1D_force_displacement}. 

\begin{figure}[h]
	\centering
	\input{./tikz_figs/1D_comparison_x.tex}
	\caption{Variation of damage along the center of the bar, $y=0$, $x \in [-0.02,0.02]$ \unit{\meter}.}
	\label{1D_comparison_x}
\end{figure}

\begin{figure}[ht]
	\centering
	\input{./tikz_figs/1D_force_displacement.tex}
	\caption{Force displacement curves of the 2D-1D bar for three different meshes.}
	\label{1D_force_displacement}
\end{figure}

It can be seen that in all the cases, the results are independent of the mesh size. The width of the damage zone does not change as the mesh is refined. Likewise, the force-displacement curve also remains the same for all the mesh sizes. A severe snap-back can be seen in the figure \ref{1D_force_displacement}, which has been captured by the arc length method. It shall be noted that the saw-tooth-like pattern observed in the 1D case, where the constraint is strictly enforced, is again observed even in the current case. Perhaps testing with different values of $\mu$ in the solver or using a different arc length solver might smoothen the results. This has not been pursued further in this article and can be the focus of future work.


\subsection{L Beam}

The regularization technique has also been applied to the case of an L-beam subjected to a vertical displacement. It is fixed horizontally at its bottom end and the applied displacement is again determined through the arc length method.



\begin{figure}
	\centering
	\includegraphics[width=0.4\linewidth]{./Images/L/L_beam.pdf}
	\caption{Geometry of the L-beam. All dimensions are in meters.}
	\label{L_beam_dims}
\end{figure}

\begin{figure}[ht]
	\begin{subfigure}{0.32\textwidth}
		\centering
		\includegraphics[width=0.9\textwidth]{./Images/L/damage_coar.pdf}
		\caption{Coarse mesh}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.32\textwidth}
		\centering
		\includegraphics[width=0.9\textwidth]{./Images/L/damage_inter.pdf}
		\caption{Intermediate mesh}
	\end{subfigure}
	\hfill
	\begin{subfigure}{0.32\textwidth}
		\centering
		\includegraphics[width=0.9\textwidth]{./Images/L/damage_fine.pdf}
		\caption{Fine mesh}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\vfill
		\includegraphics[width=0.4\linewidth]{./Images/L/cb.pdf}
	\end{subfigure}
	\caption{Results with regularization}
	\label{fig:Results_with_ration}
\end{figure}

\begin{figure}[ht]
	\centering
	\input{./tikz_figs/L_comparison_y.tex}
	\caption{Variation of damage along the ar, $y=0$, $x \in [-0.02,0.02]$ \unit{\meter}.}
	\label{L_comparison_y}
\end{figure}


\begin{figure}[ht]
	\centering
	%\input{./tikz_figs/L_force_displacement.tex}
	\includegraphics{./Images/L/force_displacement.pdf}
	\caption{Force displacement curves of the 2D-1D bar for three different meshes.}
	\label{L_force_displacement}
\end{figure}

\section{Discussion}

The results presented in this study highlight the critical role of the chosen metric and solver strategy in determining the convergence behavior of the data-driven (DD) algorithm. The analysis performed on the rate of convergence of the method reveals the necessity of using the \textit{tangent} as the \textit{metric} for a better rate of convergence. In some cases where some instabilities such a snapback are expected, using a good (and in fact, correct) metric is necessary to even achieve convergence. Also, it was determined using an arc length (AL) solver is also necessary in some cases to achieve convergence. The AL solver is, however, not sufficient on its own. It should be coupled with a correct value of metric. The AL solver, together with a correct metric resulted in the solution exhibiting a behavior characteristic of softening problems even in DD simulations. It shall be noted that using a tangent for metric has been discussed earlier in some studies \cite{Pham2023,Nguyen2022,Kanno2019}. However, those studies were limited to improving the rate of convergence of the method and only examine the cases where there are no instabilities. The application of DD method to a case involving a snap through can be found in \cite{Kuang2023}. The authors of that study apply the DD method to a case where an instability develops as a consequence of geometric non-linearity. The initial guess for the alternate minimization in DD algorithm is perturbed to achieve convergence. To the best of the authors' knowledge, the current article is the first instance where the importance of metric, together with the need for an AL solver is first discussed when a material instability is encountered. 


The case of a 1D bar subjected to a body force demonstrates that finite element (FE) results exhibit mesh dependence, but in a manner consistent with what is typically observed when a constitutive model is used, provided a good metric and the arc-length (AL) method are employed. The regularization introduced in \cite{Kamasamudram2023} can also be seen to remove the mesh dependence of the solution in the DD setting. The saw tooth like pattern observed in the load displacement curves in figures 7 and 9 of \cite{Kamasamudram2023} can also be seen in the DD framework, as seen in figures \ref{force_disp_nonlocal} and \ref{force_disp_nonlocal_zoom} for two different mesh sizes. Since it has earlier been demonstrated that the DD solver lacks the ability to jump through the snap backs, it is essential that the DD solver (with AL method) track all the observed snap backs to obtain a mesh independent solution. This can be observed in the current case in the strain distributions for two mesh sizes in figure \ref{strain_dist_nonlocal} for the current case. Furthermore, it remains unclear whether applying the method without the AL method and using an incorrect metric would still yield a mesh-independent solution, even with regularization. While not explicitly reported in this article, preliminary analyses indicate that achieving convergence proves to be particularly challenging when a poor metric is used and the AL solver is omitted, especially for finer meshes.

The method has then been extended to the 2D case, but after relaxing the Lipschitz constraint aiming to smoothen out or even eliminate the saw tooth pattern observed in the load displacement curve in the 1D setting.  

%The convergence issues associated with using a Newton solver for on-convex problems can be seen in various references. \cite{Farrell2017} monitor the residual during the Newton iterations and resort to alternate minimization if the residual is observed to increase. The Newton method is then resumed once the solution arrives into the \textit{basin of convergence}. \cite{Gerasimov2016} propose a modified line search method where the line search parameter is allowed to take on negative values owing to the non-convexity of the energy functional. 



\section{Conclusion}

\bibliography{library}

\appendix

\section{Analysis of convergence \label{appx_convergence}}
Consider the case of a 1D bar with an element in the middle already on the damaged branch while the other elements undergo unloading on the elastic branch, see Figure \ref{1D_bar_dam_elem}. It is the intent to check the effect of the metric in data driven case on the (rate of) convergence of the solution in this case. If the material behavior is described by a local damage model (without any regularization), a snapback is expected in the load displacement response of the body in some scenarios, depending on the mesh size.
\begin{figure}
	\centering
	\includegraphics[scale=1.2]{1D_bar_dam_elem.pdf}
	\caption{1D bar with damaged element\label{1D_bar_dam_elem}}
\end{figure}

The stress state is homogeneous in the entire bar as a consequence of equilibrium. The strain is localized in the element undergoing damage (in blue), while the other elements are unloading (in red). Thus, the mechanical state of the bar is described by a scalar stress $\sigma \in \mathbb{R}$ and strains $\epsilon_1, \epsilon_2 \in \mathbb{R}$ ($\epsilon_1$ for the undamaged elements and $\epsilon_2$ for the damaged element). The material state is described by $(\epsilon_1^*, \sigma_1^*) \in \mathbb{R}^{1\times 1}$ and $(\epsilon_2^*, \sigma_2^*) \in \mathbb{R}^{1\times 1}$. The loading is driven by prescribing $u_D$, the displacement at the right end of the bar. The distance function in this is given by 
\begin{equation}
	d(\sigma,\sigma_1^*,\sigma_2^*,\epsilon_1,\epsilon_2;u_g) = \frac{N \ell_e}{2} \left[ \frac{(\sigma - \sigma_1^*)^2}{C_1} +  C_1(\epsilon_1 - \epsilon_1^*)^2 \right] + \frac{\ell_e}{2}  \left[ \frac{(\sigma - \sigma_2^*)^2}{C_2} +  C_2(\epsilon_2 - \epsilon_2^*)^2 \right].
\end{equation}
The compatibility condition is $N \epsilon_1 + \epsilon_2 = u_D/\ell_e$.

Now, taking the variations with respect to the compatibility equation as a constraint, the system of equations for $\epsilon_1,\epsilon_2$ and $\sigma$ are obtained as 
\begin{equation}
	\begin{bmatrix}
		\epsilon_1 \\
		\epsilon_2 \\
		\sigma
	\end{bmatrix}
	=
	\begin{bmatrix}
		C_1/(C_1+NC_2) & -C_2/(C_1+NC_2) & 0 & 0 \\
		-NC_1/(C_1+NC_2) & NC_2/(C_1+NC_2) & 0 & 0 \\
		0 & 0 & \frac{NC_2}{C_1+N C_2} & \frac{C_1}{C_1+N C_2}
	\end{bmatrix}
	\begin{bmatrix}
		\epsilon_1^* \\
		\epsilon_2^* \\
		\sigma_1^* \\
		\sigma_2^* 
	\end{bmatrix}
	+
	\begin{bmatrix}
		C_2 u_D/(C_1+NC_2)/\ell_e \\
		C_1 u_D/(C_1+NC_2)/\ell_e  \\
		0	
	\end{bmatrix}
	.
\end{equation}
The material states can be found by taking the variations with respect to $\epsilon_1^*, \epsilon_2^*$, while realizing that $\sigma_1^*=E\epsilon_1^*$, and $\sigma_2^*=m\epsilon_2^*+c$. Thus,
\begin{equation}
	\begin{bmatrix}
		\epsilon_1^* \\
		\epsilon_2^* \\
		\sigma_1^* \\
		\sigma_2^* 
	\end{bmatrix} 
	= 
	\begin{bmatrix}
		C_1^2/(E^2 + C_1^2) & 0 & E/(E^2 + C_1^2) \\
		0 & C_2^2/(m^2 + C_2^2)  & m/(m^2 + C_2^2) \\
		E C_1^2/(E^2 + C_1^2) & 0 & E^2/(E^2 + C_1^2)\\
		0 & mC_2^2/(m^2 + C_2^2)  & m^2/(m^2 + C_2^2) 
	\end{bmatrix} 
	\begin{bmatrix}
		\epsilon_1 \\
		\epsilon_2 \\
		\sigma
	\end{bmatrix} + 
	\begin{bmatrix}
		0 \\
		-mc/(m^2+C_2^2) \\
		0 \\
		cC_2^2/(m^2+C_2^2)
	\end{bmatrix} .
\end{equation}

The system of equations corresponding to the mechanical and material updates can be written in short as $\bfa = \bfA \bfb + \bfc$, and $\bfb = \bfC \bfa + \bfd$. The alternating minimization can then be written as
\begin{gather}
	\bfa^{n+1} = \bfA \bfb^{n} + \bfc, \\
	\bfb^{n+1} = \bfC \bfa^{n+1} + \bfd.
\end{gather}
Combining them together, 
\begin{equation}
	\bfb^{n+1} = \bfC \bfA \bfb^{n} +\bfC \bfc + \bfd. \label{combined_equn}
\end{equation}
At convergence, $\bfb^{n+1} \approx \bfb^{n} \approx \bfb$. Thus, $\bfe^{n+1} = \bfC \bfA \bfe^{n}$, where $\bfe^{n+1} = \bfb^{n+1} - \bfb$ is the error at the iteration $n+1$. The rate of convergence of the method depends on the spectral radius of the matrix $\bfC \bfA$, which in turn depends on the metric chosen. 

\subsubsection*{With snapback}
The case with snapback occurs when the mesh and thus, the size of the damage zone, is refined. In this case, an arc length solver is needed to track the full damage evolution in the element. So, this case will first be presented and the effect of metric on the rate of convergence will be studied.

Using an arc length solver corresponds to when the displacement at the end of the bar, $u_D$, is treated as an unknown. This results in the number of unknowns increasing by $1$. The additional equation that is needed to fully resolve the system is the arc length constraint, stated in equation \ref{onedarclength}. This changes the equations to be resolved in the previous section to 


\begin{multline}
	\begin{bmatrix}
		1 & 0& 0&  -C_2/(C_1+NC_2) \ell_e \\
		0 & 1 & 0 & -C_1/(C_1+NC_2) \ell_e \\
		0 & 0 & 1 & 0 \\
		0 & 1 & 0 & 0
	\end{bmatrix}
	\begin{bmatrix}
		\epsilon_1 \\
		\epsilon_2 \\
		\sigma \\
		u_D
	\end{bmatrix}
	= \\
	\begin{bmatrix}
		C_1/(C_1+NC_2) & -C_2/(C_1+NC_2) & 0 & 0 \\
		-NC_1/(C_1+NC_2) & NC_2/(C_1+NC_2) & 0 & 0 \\
		0 & 0 & \frac{NC_2}{C_1+N C_2} & \frac{C_1}{C_1+N C_2} \\ 
		0 & 0 & 0&0
	\end{bmatrix}
	\begin{bmatrix}
		\epsilon_1^* \\
		\epsilon_2^* \\
		\sigma_1^* \\
		\sigma_2^* 
	\end{bmatrix}
	+
	\begin{bmatrix}
		0 \\
		0  \\
		0	\\
		\epsilon_0 + \Delta \epsilon
	\end{bmatrix}
	.
\end{multline}
The material states can be found by taking the variations with respect to $\epsilon_1^*, \epsilon_2^*$, while realizing that $\sigma_1^*=E\epsilon_1^*$, and $\sigma_2^*=m\epsilon_2^*+c$. Thus,
\begin{equation}
	\begin{bmatrix}
		\epsilon_1^* \\
		\epsilon_2^* \\
		\sigma_1^* \\
		\sigma_2^* 
	\end{bmatrix} 
	= 
	\begin{bmatrix}
		C_1^2/(E^2 + C_1^2) & 0 & E/(E^2 + C_1^2) & 0 \\
		0 & C_2^2/(m^2 + C_2^2)  & m/(m^2 + C_2^2) &0 \\
		E C_1^2/(E^2 + C_1^2) & 0 & E^2/(E^2 + C_1^2) &0\\
		0 & mC_2^2/(m^2 + C_2^2)  & m^2/(m^2 + C_2^2) &0
	\end{bmatrix} 
	\begin{bmatrix}
		\epsilon_1 \\
		\epsilon_2 \\
		\sigma \\
		u_D
	\end{bmatrix} + 
	\begin{bmatrix}
		0 \\
		-mc/(m^2+C_2^2) \\
		0 \\
		cC_2^2/(m^2+C_2^2)
	\end{bmatrix} .
\end{equation}

Thus, even in this case, the update can be cast into the form of equation \ref{combined_equn} and can be analyzed similarly.

\section{Euler Lagrange equations}
Finding the solution of the boundary value problems consists of minimizing the potential energy functional which is defined as
\begin{equation}
	\Pi(\bfu) = \int_\Omega \psi(\bfeps) \diff v - W_{\ext}(\bfu).
\end{equation}
Here, $\psi$ denotes the strain energy density functional, $\bfeps$ is the symmetric part of the gradient of displacement $\bfu$, and $W_{\ext}$ denotes the potential of the external forces. In the case of material that undergoes damage, the strain energy function is made to depend on the damage as well, $\psi(\epsilon,d)$, where $d$ denotes the damage variable. $d$ takes the values in the interval $[0,1]$, where the value of $0$ indicates a pristine material and $1$ indicates a fully damaged material. In this case, the potential energy becomes
\begin{equation}
	\Pi(u,d) = \int_\Omega \psi(\bfeps,d) \diff v - W_{\ext}(\bfu) + \int_{0}^{t} D \diff t,
\end{equation}
where $D$ denotes the dissipation function~\cite{Mielke2005}. An evolution equation for damage can be specified using the notion of standard general materials~\cite{Nguyen1975}. The solution to the problem is the one that minimizes the potential energy over all the admissible functions.
\begin{equation}
	\left(\bfu^*,d^*\right) \in \arg \min_{(\bfu,d)\,\in\,\left(\cc^u \times \cc^d_n;d_{n-1}\right)} \Pi(\bfu,d),
\end{equation}
where $\cc^u$ and $\cc^d$ denote the space of admissible displacements and damages, respectively. They are defined as
\begin{gather}
	\cc^u = \left\{ \bfu \in H^2(\Omega)\, \middle| \, \bfu=\bfu_d \quad\text{on }\; \partial \Omega_d \right\}, \\
	\cc^d_n = \left\{ d \in L^\infty(\Omega)\, \middle| \, d(\bfx) \geq d_{n-1}(\bfx) \quad\text{and}\quad d(\bfx) \in [0,1] \, \forall \bfx \in \Omega \right\}.
\end{gather}
The definition of the space $\cc^d$ ensures the irreversibility of the damage. 

It is well known that the formulation just presented is devoid of any length scale and as such, the solution in the FE simulations become mesh dependent. In \cite{Kamasam}, the length scale is introduced by constraining the gradient of the strain to lie in a certain interval in 1D case. Here, the regularization will be introduced by weakening the constraint by using a log-barrier-like function. Thus, the functional to be minimized becomes
\begin{equation}
	\Pi(u,d;\ell_c) = \int_\Omega \psi(\bfeps,d) \diff v +  \int_\Omega \hat{\psi}(\nabla \bfeps,d;\ell_c) \diff v  - W_{\ext}(\bfu) + \int_{0}^{t} D \diff t,
\end{equation}
where, 
\begin{equation} \label{energy_constraint_gradient}
	\hat{\psi}(\nabla \bfeps,d;\ell_c) = -\mu \ln \left( \frac{1}{\ell_c} - g(d) \tilde{\psi}(\nabla \epsilon)  \right),
\end{equation}
where $g$ is the degradation function that depends on the damage, that is used to gradually remove the regularization as the damage increases. $\hat{\psi}$ is the quadratic functional that depends on the gradient of strain, which is defined as 
\begin{equation} \label{energy_constraint_gradient}
	\tilde{\psi}(\nabla \bfeps) = a_1 k_{iik}k_{kjj} + a_2 k_{ijj}k_{ikk} + a_3 k_{iik}k_{jjk} + a_4 k_{ijk}k_{ijk} + a_5 k_{ijk}k_{kji},
\end{equation}
where $k_{pqr} = \epsilon_{qr,p}$.

A couple of observations are warranted. First, the function $g$ is selected so that $g(0)=1$ and $g(1)=0$. This means that when there is no damage, the regularization is fully effective, and when fully damaged, the regularization is removed, and the transition is gradual if $g$ is smooth. Second, in this study, the parameter $\mu$ is fixed tp be a finite positive value. It shall be noted that the method resembles the interior point method of resolving inequality constraints in the standard optimization setting, where successive problems are solved with decreasing $\mu$, $\mu \to 0$. Thus, as the parameter $\mu$ is made smaller, the method presented here boils down to the inequality case and the problems/ features about snapback that were observd in the 1D case return. It is expected that taking $\mu$ to be finite and fixed prevents this issue. 


The equations of equilibrium can now be obtained by taking the variation of the potential energy functional in equation \ref{Total_potential_energy_model} and equating it to zero. For notational simplicity, the slack quantity, $s$, is defined as $s = \frac{1}{\ell_c} - g(d) \tilde{\psi}(\nabla \epsilon)$. Taking the variations with respect to the displacement,
\begin{equation}
	\delta^{\bfu} \tilde{\Pi}(\bfu,d,\lambda) = \int_\Omega \left( \bfsig : \delta \bfeps + \bftau . \nabla \delta \bfeps \right) \diff v = 0,
\end{equation}
where $\bfsig = \psi'(\bfeps;d)$, $\bftau = \frac{\mu}{s}\tilde{\psi}'(\nabla\bfeps;d)$, prime denotes taking a derivative with respect to the argument.
Written in index form, 
\begin{equation}
	\int_\Omega \left( \sigma_{ij}  \delta \epsilon_{ij} + \tau_{ijk}  \delta k_{ijk} \right) \diff v = 0. \label{equilibruim_in_index}
\end{equation}
It can be seen that $\bftau$ is the couple stress that is normally encountered in the strain gradient elasticity. Integrating equation \ref{equilibruim_in_index} by parts and gathering like terms together, the following equation can be obtained
\begin{equation}
	-\int_\Omega \left( \sigma_{kj,j} - \tau_{ijk,ij} \right) \delta u_{k} \diff v + \int_\Omega \left[  (\sigma_{ij} -\tau_{pij,p}) \delta u_{i,j} + (\tau_{ijk} \delta u_{j,k})_{,i} \right] \diff v  = 0. \label{equilibruim_in_index_parts}
\end{equation}
Dividing the domain $\Omega$ into regions where the constraints are active, $\Omega_a$, and where the constraints are inactive, $\Omega \setminus \Omega_a$, and realizing that $\lambda=0$ and hence $\bftau = 0$ in $\Omega \setminus \Omega_a$, the above integral can be written as 
\begin{equation}
	-\int_\Omega \left( \sigma_{kj,j} - \tau_{ijk,ij} \right) \delta u_{k} \diff v + \int_\Omega \left[  (\sigma_{ij} -\tau_{pij,p}) \delta u_{i,j} + (\tau_{ijk} \delta u_{j,k})_{,i} \right] \diff v  = 0.
\end{equation}
This leads to the equations of equilibrium in the bulk as 
\begin{equation}
	(\sigma_{kj} - \tau_{ijk,i})_{,j} = 0.
\end{equation}
It shall be noted that the above set of equations are similar to what is encountered in the case of first strain gradient theories in \cite{Mindlin and Toupin}, with the couple stress analogous to the strain gradient theory. ....Similarly, the equations on the surface can be obtained....

\subsection{Discrete version of the constraint}
To impose the constraint on the strain variable, a dual mesh (also called the lip mesh) is defined along with the FE mesh as has been done in \cite{Moes and Chevaugeon}. It shall be noted that the constraint on the strain variable requires its derivative. In discrete formulation, the gradient of the strain variable is computed on the lip mesh by using the strain variables computed from the FE mesh. The strain variables, computed from the displacements can be expressed as $\bfeps = \bfB \bfu$, where $\bfB$ is the discrete gradient operator, computed on the FE mesh. Likewise, defining the discrete gradient operator on the lip mesh and representing it in a matrix form as $\bfG$, the gradients of strain can be expressed in terms of the displacements as 
\begin{equation}
	\bfk = \nabla \bfeps = \bfG \bfB \bfu = \bfP \bfu.
\end{equation}
Where, $\bfk$ is the matrix containing the gradients of strain as $\begin{bmatrix}
	k_{111} & k_{211} & k_{122} & k_{222} & k_{112} & k_{212}
\end{bmatrix}^T$.

The constraint on the strain gradient can thus be written as 
\begin{equation} \label{discrete_constraint}
	(\bfLam \bfk )^T \bfLam \bfk \leq \frac{1}{\ell_c^2},
\end{equation}
where $\bfLam$ is a matrix composed of the coefficients $a_i$ from equation \ref{energy_constraint_gradient}. Hence, there will be as many (not necessarily active) constraints as the number of elements in the lip mesh.

\begin{figure}[ht]
	\centering
	\input{./tikz_figs/comparison_log_quadratic.tex}
	\caption{Log barrier function vs quadratic functional}
	\label{comparison_log_quadratic}
\end{figure}

\section{Arc length constraint}
The arc length constraint is simpler in 1D case than in 2D case as it involves selecting degrees of freedom where a certain quantity is monotone increasing. For instance, in \cite{}, the damage variables are used to write the arc length constraint. In the current case, for the 1D bar, the mechanical strain variable at the left end of the bar is chosen to impose the arc length constraint. The constraint can be expressed as
\begin{equation}
	\epsilon^{n+1} - \epsilon^{n} = \Delta, \label{onedarclength}
\end{equation}
where $n+1$ and $n$ denote the load steps. $\Delta$ is the arc length, which in the current case is the strain increment for the element at the extreme left between two steps. Expressing the displacements as $\bfu = \bfC_f \bfu_f + \lambda \bfu_g$, where $\bfu_f$ denotes the unknown/free degrees of freedom and $\lambda$, in the current case, is the displacement applied at the right end with $u_g$ as the corresponding degree of freedom. For instance, if the bar contains $N$ nodes numbered $1$ to $N$, $\bfu_f$ contains the DOFs of the nodes $2$ to $N-1$. $\bfC_f \in \mathbb{R}^{N \times N-2}$ and $\bfu_g \in \mathbb{R}^N = \{0,0,0,\dots 1\}^T$.

In 2D case, the method is slightly involved. The aim is to identify the degrees of freedom where a specific quantity is always increasing. For this purpose, the elements whose material states lie on the 'damage branch' are first identified. The damage levels in these elements are thus increasing in the load step under consideration. Then, an equivalent strain energy density of the mechanical states corresponding to these elements are computed using the mechanical strains. The arc length constraint is now written using these degrees of freedom and their 'equivalent strain energy'.

% \section{Trash Appendix}
%The notion of Data Driven Computational Mechanics has been introduced in \cite{KO}, where the constitutive model for the material is replaced by a database of stresses and strains (material states). The solution for the boundary value problem is sought as the stress-strain pair that satisfy the equations of equilibrium and compatibility conditions (mechanical states) while being as close as possible to the database (material states). Formally, the distance functional between the mechanical and material states is introduced as 
%\begin{equation}
%	d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{\mathcal{C}}{2}(\bfeps - \bfeps^*):(\bfeps - \bfeps^*) + \frac{\mathcal{C}^{-1}}{2}(\bfsig - \bfsig^*):(\bfsig - \bfsig^*).
%\end{equation}
%The solution to the BVP then becomes
%\begin{equation}
%	\text{Sol } \in \arg \min_{(\bfeps,\bfsig) \in \mathcal{E}, (\bfeps^*,\bfsig^*) \in \mathcal{D}} d(\bfeps,\bfsig,\bfeps^*,\bfsig^*),
%\end{equation}
%where 
%\begin{equation}
%	\mathcal{E} = \{(\bfeps,\bfsig) \text{ sufficiently regular }: \bfeps = \sym \nabla \bfu, \bfu = \bfu_D \text{ on } \partial \Omega_d \text{ and } \divop \bfsig = 0     \},
%\end{equation}
%and $\mathcal{D}$ denotes the material database. Compatibility can be ensured by directly using $\bfeps = \sym \nabla\bfu$ in the distance functional, while the equilibrium constraints can be imposed by using Lagrange multipliers. The discrete version of the above equations can be seen as (with the compatibility conditions used directly in the distance functional and imposing equilibrium through Lagrange multipliers)
%\begin{equation}
%	\Pi(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{1}{2}(\bfB \bfu - \bfeps^*)^T\mathcal{C}(\bfB \bfu - \bfeps^*) + \frac{1}{2}(\bfsig - \bfsig^*)^T\mathcal{C}^{-1}(\bfsig - \bfsig^*) - \bfeta^T \bfB^T \bfsig .
%\end{equation}
%Assuming the material states to be given, taking the variations of the Lagrangian with respect to the mechanical states results in the Euler-Lagrange equations as
%\begin{gather}
%	\bfB ^T \bfD \bfB \bfu = \bfB \bfD \bfeps^*, \\
%	\bfsig  = \bfsig^* + \bfD \bfB \bfeta, \\
%	\bfB ^T \bfsig = 0.
%\end{gather}
%The second and third of the above equations result in
%\begin{equation}
%	\bfB ^T \bfD \bfB \bfeta = -\bfB ^T \bfsig^*.
%\end{equation}
%The material states are then found as the points in the database that minimize the distance functional, given the mechanical states.
%
%\subsection{Inclusion of the constraint}
%The Lipschitz constraint on the strain variable can be introduced in data driven case as described below. It shall be noted that the inclusion of constraints modifies the equations of equilibrium, where the Lagrange multipliers take the place of couple stress. As in the earlier case, the distance functional is defined as 
%\begin{equation}
%	d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) = \frac{1}{2}(\bfB \bfu - \bfeps^*)^T\mathcal{C}(\bfB \bfu - \bfeps^*) + \frac{1}{2}(\bfsig - \bfsig^*)^T\mathcal{C}^{-1}(\bfsig - \bfsig^*).
%\end{equation}
%The objective now is to see the minimizers of the above functional so that the strain field satisfies the Lipschitz constraint. The Lagrange multipliers that enforce the constraint on the strain field act as couple stresses.
%\begin{equation}
%	\text{Sol } \in \arg \min_{(\bfeps,\bfsig) \in \mathcal{E}, (\bfeps^*,\bfsig^*) \in \mathcal{D}} d(\bfeps,\bfsig,\bfeps^*,\bfsig^*),
%\end{equation}
%where, the equilibrium manifold is now defined as (in discrete form)
%
%\begin{equation}
%	\mathcal{E} = \{(\bfeps,\bfsig) : \bfeps = \bfB \bfu, \bfeps \text{ satisfies equation \ref{discrete_constraint}},\bfu = \bfu_D \text{ on } \partial \Omega_d,
%	\text{ and } \bfB ^T \bfsig - \bfP^T \bftau = 0     \},
%\end{equation}
%where $\bftau$ is as defined in equation \ref{couple_stress}. Euler Lagrange equations can be obtained by taking the variation of the following Lagrangian and equating the corresponding variations to $0$. The Lagrangian can be defined to be
%\begin{multline}
%	\Pi = d(\bfeps,\bfsig,\bfeps^*,\bfsig^*) - \bfeta^T \bfB ^T \bfsig + \sum_{i=1}^{N_c} \lambda^u_i \left( (\bfP \bfu )_i^T \bfLam (\bfP \bfu)_i - \frac{1}{\ell_c^2}   \right) + \sum_{i=1}^{N_c} \lambda^{\eta u}_i \left( (\bfP (\bfu + \bfeta) )_i^T \bfLam (\bfP (\bfu + \bfeta))_i - \frac{1}{\ell_c^2}   \right).
%\end{multline}
%Here, $N_c$ denotes the number of active constraints and $\lambda_i \geq 0$ are the Lagrange multipliers dual to the constraint on the gradient of strain. $\lambda^{\eta u}_i = -\lambda^{ u}_i$ at convergence, take the role of the couple stresses as in equation \ref{equilibruim_in_index}. Plainly stating, the above equation states that the displacement field satisfies the inequality constraints, and in the places where the constraint is satisfied as an equality, the \textit{perturbed solution (with $\bfeta$)} should also satisfy the constraints.
%
%
%
%The EL equations can be seen to be
%\begin{gather}
%	\bfr_{\bfu} = \bfB^T \mathcal{C} \bfB \bfu - \bfB^T \mathcal{C} \bfeps ^* + \sum_{i=1}^{N_c} \lambda_i^u \left( 2 \bfP_i ^T \bfLam \bfP_i \bfu \right) + \sum_{i=1}^{N_c} \lambda_i^{\eta u} \left( 2 \bfP_i ^T \bfLam \bfP_i (\bfu+\bfeta) \right) =0, \\
%	\bfr_{\bfeta} = -\bfB^T \mathcal{C} \bfB \bfeta - \bfB^T \bfsig ^* + \sum_{i=1}^{N_c} \lambda_i^{\eta u} \left( 2 \bfP_i ^T \bfLam \bfP_i (\bfu+\bfeta) \right) =0, \\
%	r_{\lambda^u_i} = (\bfP \bfu )_i^T \bfLam (\bfP \bfu)_i - \frac{1}{\ell_c^2}  =0, \\
%	r_{\lambda^{\eta u}_i} = \bfP (\bfu + \bfeta) )_i^T \bfLam (\bfP (\bfu + \bfeta))_i - \frac{1}{\ell_c^2}  =0. 
%\end{gather}
%

\bibliography{data_driven_damage}
\end{document}
%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% End: 
